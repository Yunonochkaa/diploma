# **Дипломная работа “Облачное хранилище”**  

---

## 1. Описание проекта
Разработать приложение - REST-сервис. Сервис должен предоставить REST интерфейс для возможности загрузки файлов и вывода списка уже загруженных файлов пользователя. 
Все запросы к сервису должны быть авторизованы. Заранее подготовленное веб-приложение (FRONT) должно подключаться к разработанному сервису без доработок, 
а также использовать функционал FRONT для авторизации, загрузки и вывода списка файлов пользователя.

### Требования к приложению:
- Сервис должен предоставлять REST интерфейс для интеграции с FRONT
- Сервис должны реализовывать все методы описанные CloudServiceSpecification.yaml:
  1. Вывод списка файлов
  2. Добавление файла
  3. Удаление файла
  4. Авторизация
- Все настройки должны вычитываться из файла настроек (yml)
- Информация о пользователях сервиса (логины для авторизации) и данных должны храниться в базе данных (на выбор студента)

### Требования в реализации
- Приложение разработано с использованием Spring Boot
- Использован сборщик пакетов gradle/maven
- Для запуска используется docker, docker-compose
- Код размещен на github
- Код покрыт unit тестами с использованием mockito
- Добавлены интеграционные тесты с использованием testcontainers

### Шаги реализации:
- Изучить протокол получения и отправки сообщений между FRONT и BACKEND
- Нарисовать схему приложений
- Описать архитектуру приложения (где хранятся настройки и хранение больших файлов, структуру таблиц/коллекций базы данных)
- Создать репозиторий проекта на github
- Написать приложение с использованием Spring Boot
- Протестировать приложение с помощью curl/postman
- Протестировать приложение с FRONT
- Написать README.md к проекту
- Отправить на проверку

### Описание и запуск FRONT
1. Установите nodejs (версия не ниже 19.7.0) на компьютер, следуя инструкции.
2. Скачайте FRONT (JavaScript).
3. Перейдите в папку FRONT приложения и все команды для запуска выполняйте из неё.
4. Следуя описанию README.md FRONT проекта, запустите nodejs-приложение (npm install, npm run serve).
5. Далее нужно задать url для вызова своего backend-сервиса.

a) В файле .env FRONT (находится в корне проекта) приложения нужно изменить url до backend, например: VUE_APP_BASE_URL=http://localhost:8080.
  
b) Нужно указать корневой url вашего backend, к нему frontend будет добавлять все пути согласно спецификации

c) Для VUE_APP_BASE_URL=http://localhost:8080 при выполнении логина frontend вызовет http://localhost:8080/login

d) Запустите FRONT снова: npm run serve.

e) Изменённый url сохранится для следующих запусков.
6. По умолчанию FRONT запускается на порту 8080 и доступен по url в браузере http://localhost:8080.
  i. Если порт 8080 занят, FRONT займёт следующий доступный (8081). После выполнения npm run serve в терминале вы увидите, на каком порту он запустился.

### Авторизация приложения:
FRONT-приложение использует header auth-token, в котором отправляет токен (ключ-строка) для идентификации пользователя на BACKEND. Для получения токена нужно пройти авторизацию на BACKEND и отправить на метод /login логин и пароль. В случае успешной проверки в ответ BACKEND должен вернуть json-объект с полем auth-token и значением токена. Все дальейшие запросы с FRONTEND, кроме метода /login, отправляются с этим header. Для выхода из приложения нужно вызвать метод BACKEND /logout, который удалит/деактивирует токен. Последующие запросы с этим токеном будут не авторизованы и вернут код 401.

Обратите внимание, что название самого параметра (как и всех параметров в спецификации), его регистр имеют значение. Важно, чтобы ваш backend возвращал токен в поле auth-token – если поле будет называться authToken или authtoken, фронт не сможет найти токен и дальше логина процесс не пройдёт.
> Для запуска FRONT приложения с расширенным логированием нужно использовать команду: npm run serve


## 2. Руководство по запуску
### Запуск приложения cloud_storage с помощью файла docker-compose.yml (Dockerfile) (frontendApp + backendApp + postgres)
- Клонируем проект на свой ПК (https://github.com/Yunonochkaa/diploma);
- Запускаем приложение Docker Desktop;
- Открываем проект в среде разработки IntelliJ IDEA;
- Собираем jar файл
- В докере запустятся 3 приложения:
  - backend-server, Java 17 на порту: ```http://localhost:8888```;
  - frontend-client, Node 24 на порту: ```http://localhost:8080```;
  - database-server на порту: ```http://localhost:3306```;


### Для тестирования frontend + backend + mysql нужно авторизовать пользователя:
 - Отправить POST запрос `http://localhost:8888/login`
 - JSON -> `{
"login": "User",
"password": "user1234"
}` 

### Если в БЗ Mysql нет этого пользователя, то нужно создать пользователя 
- Отправить POST запрос `http://localhost:8888/user/register`
- JSON -> `{
  "login": "User",
  "password": "user1234"
  }`

## БЗ

В приложении используется СУБД MySQL, со следующими настройками:

`spring.datasource.url=jdbc:mysql://localhost:3306/mysqlDataBase?createDatabaseIfNotExist=true`

`spring.datasource.username=root`

`spring.datasource.password=root`

В программе используется 3 таблицы БД:

* user_entity - для хранения пользователей. Поля id, login, password, role
* file_entity - для хранения файлов. Поля id, file_name, file_type, file_data, hash, size, user_id
* user_entity_roles - для сопостановления пользователя и ролей. Поля id, roles, user_entity_id


